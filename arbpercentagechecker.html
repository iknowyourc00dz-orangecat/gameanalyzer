<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Arb / Turnover Calculator</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');
  body { 
    font-family: 'Poppins', Arial, sans-serif; 
    background:#0b0c1a; 
    color:#bdfcff; 
    padding:30px; 
    line-height:1.6;
  }
  h1 { 
    font-size:26px; 
    margin-bottom:20px; 
    color:#00e6ff; 
    text-shadow: 0 0 4px #00e6ff; 
    text-align:center;
  }
  .box { 
    background:#0a0b15; 
    padding:25px; 
    border-radius:10px; 
    box-shadow:0 0 8px #00e6ff; 
    max-width:900px; 
    margin:auto; 
    border:1px solid #00e6ff; 
  }
  label { 
    display:block; 
    margin-top:15px; 
    font-weight:600; 
    color:#9ef; 
    font-size:15px;
  }
  input[type="number"], input[type="text"] {
    width:100%; 
    padding:12px; 
    border-radius:8px; 
    border:1px solid #00bcd4; 
    margin-top:6px; 
    font-size:15px; 
    background:#0a0b15; 
    color:#bdfcff; 
    outline:none;
  }
  input::placeholder {
    color:#6fbfff; 
    opacity:0.7;
  }
  button { 
    margin-top:20px; 
    background:#00e6ff; 
    color:#000; 
    border:none; 
    padding:12px 22px; 
    font-size:16px; 
    border-radius:8px; 
    cursor:pointer; 
    box-shadow:0 0 5px #00e6ff; 
    font-weight:600;
  }
  button:hover { background:#00c8ff; }

  #downloadBtn {
    background:#00ff99;
    box-shadow:0 0 5px #00ff99;
    margin-left:10px;
  }
  #downloadBtn:hover { background:#00e68a; }

  table { 
    width:100%; 
    border-collapse:collapse; 
    margin-top:25px; 
    font-size:15px; 
    color:#bdfcff; 
    border:1px solid #00bcd4; 
  }
  th, td { 
    border:1px solid #00bcd4; 
    padding:12px 10px; 
    text-align:left; 
  }
  th { 
    background:#001022; 
    color:#00e6ff; 
    text-shadow: 0 0 4px #00e6ff; 
    font-weight:600;
  }
  tr:nth-child(even) { background:#00101a; }
  tr:hover { background:#001a2a; }

  .leave { color:#00ff99; font-weight:600; text-shadow:0 0 3px #00ff99aa; }
  .warn { color:#ff4da6; font-weight:600; text-shadow:0 0 3px #ff4da666; }
  .none { color:#9999ff; font-weight:600; text-shadow:0 0 3px #9999ff55; }

  .copyBtn { 
    margin-left:10px; 
    padding:4px 8px; 
    font-size:13px; 
    border-radius:6px; 
    background:#00e6ff; 
    color:#000; 
    cursor:pointer; 
    border:none; 
    box-shadow:0 0 4px #00e6ff; 
  }
  .copyBtn:hover { background:#00c8ff; }
</style>
</head>
<body>

<div class="box">
  <h1>Arbitrage / Turnover Checker</h1>

  <label>Player Name (optional):</label>
  <input type="text" id="player" placeholder="e.g. username">

  <label>Turnover Requirement:</label>
  <input type="number" id="turnover" placeholder="e.g. 5500" step="0.01">

  <label>Arb Bets:</label>
  <input type="number" id="arb" placeholder="e.g. 3500" step="0.01">

  <div style="display:flex; flex-wrap:wrap; gap:10px;">
    <button onclick="calculate()">Add Result</button>
    <button id="downloadBtn" onclick="downloadResults()">Download Results (CSV)</button>
  </div>

  <table id="results">
    <thead>
      <tr>
        <th>Player</th>
        <th>Turnover Requirement</th>
        <th>Arb Bets</th>
        <th>Arb %</th>
        <th>Remaining Turnover</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
function formatMoney(n) {
  return Number(n).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

function copyAction(button) {
  const text = button.getAttribute("data-action");
  const textarea = document.createElement("textarea");
  textarea.value = text;
  document.body.appendChild(textarea);
  textarea.select();
  document.execCommand('copy');
  document.body.removeChild(textarea);
  alert("Action copied!");
}

function calculate() {
  const player = document.getElementById("player").value.trim() || "-";
  const turnover = parseFloat(document.getElementById("turnover").value);
  const arb = parseFloat(document.getElementById("arb").value);
  if (isNaN(turnover) || isNaN(arb) || turnover <= 0) {
    alert("Please enter valid numbers for turnover and arb bets.");
    return;
  }

  const arbPct = (arb / turnover) * 100;
  const remaining = turnover - arb;
  let action = "";
  let cssClass = "";

  if (arbPct >= 70) {
    action = "Arbitrage | Leave Deposit";
    cssClass = "leave";
  } else if (arbPct < 10) {
    action = "Arb % < 10%. No significance. (DO NOT copy this text)";
    cssClass = "none";
  } else if (remaining > 0) {
    action = `Arbitrage betting is against BH's terms and conditions. Please complete the remaining turnover BDT ${formatMoney(remaining)} before withdrawal.`;
    cssClass = "warn";
  } else {
    action = "Leave deposit as it meets requirements.";
    cssClass = "leave";
  }

  const tbody = document.querySelector("#results tbody");
  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td>${player}</td>
    <td>${formatMoney(turnover)}</td>
    <td>${formatMoney(arb)}</td>
    <td>${arbPct.toFixed(2)}%</td>
    <td>${remaining > 0 ? formatMoney(remaining) : "0"}</td>
    <td class="${cssClass}">
      ${action}
      <button class="copyBtn" data-action="${action}">Copy</button>
    </td>
  `;
  tbody.appendChild(tr);

  tr.querySelector(".copyBtn").addEventListener("click", function() {
    copyAction(this);
  });

  document.getElementById("arb").value = "";
  document.getElementById("turnover").value = "";
  document.getElementById("player").value = "";
}

function downloadResults() {
  const rows = document.querySelectorAll("#results tr");
  if (rows.length <= 1) {
    alert("No results to download yet!");
    return;
  }

  const headers = ["Player", "Turnover Requirement", "Arb Bets", "Arb %", "Remaining Turnover", "Action"];
  let csvContent = headers.join(",") + "\n";

  rows.forEach((row, index) => {
    if (index === 0) return; // skip header
    const cols = row.querySelectorAll("td");
    const line = Array.from(cols).map(td => {
      // Only get text nodes, ignore buttons
      let text = Array.from(td.childNodes)
        .filter(n => n.nodeType === Node.TEXT_NODE)
        .map(n => n.textContent.trim())
        .join(" ");

      // Replace fancy quotes with ASCII
      text = text.replace(/[‘’]/g, "'").replace(/[“”]/g, '"');

      // Escape double quotes for CSV
      if (text.includes(",") || text.includes('"')) {
        text = '"' + text.replace(/"/g, '""') + '"';
      }
      return text;
    }).join(",");
    csvContent += line + "\n";
  });

  const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
  const link = document.createElement("a");
  const timestamp = new Date().toISOString().slice(0,19).replace(/[:T]/g,"-");
  link.href = URL.createObjectURL(blob);
  link.download = `arb_turnover_results_${timestamp}.csv`;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(link.href);
}
</script>

</body>
</html>
